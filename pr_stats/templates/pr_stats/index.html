{% extends "base.html" %}
{% block content %}

<h1>{% block title %}List of PRs{% endblock %}</h1>


<p><a href="{% url 'pr_stats:pulls' %}">Load data</a></p>
<p><a href="{% url 'pr_stats:statistics' %}">Stats</a></p>

{% if pr_list %}
<table class="table" id="pr_table">
    <thead>
        <tr>
            <th>#</th>
            <th>Title</th>
            <th>User</th>
            <th>State</th>
            <th>Duration</th>
            <th>Links</th>
        </tr>
    </thead>

    <tbody>
        {% for pull in pr_list %}
        <tr class="{{pull.alert}}">
            <td><a href="{% url 'pr_stats:detail' pull.number %}">{{ pull.number }}</a></td>
            <td><a href="{% url 'pr_stats:detail' pull.number %}">{{ pull.title }}</a></td>
            <td><img src="{{ pull.user.avatar_url }}" style="width:24px;height:24px;"></td>
            <td>{{ pull.state }}</td>
            <td data-order="{{ pull.time_open_sec }}">{{ pull.time_open }}</td>
            <td><a href="{{pull.html_url}}" target="_blank">GitHub</a></td>
        </tr>
        {% endfor %}
    </tbody>


</table>
{% else %}
<p>No polls are available.</p>
{% endif %}


<div id="timeline" style="height: 600px;"></div>

<script>
$(document).ready(function() {
$('#pr_table').dataTable();
});
</script>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
      google.charts.load('current', {'packages':['timeline']});
      google.charts.setOnLoadCallback(drawChart);
      function drawChart() {
        var container = document.getElementById('timeline');
        var chart = new google.visualization.Timeline(container);
        var dataTable = new google.visualization.DataTable();

        dataTable.addColumn({ type: 'string', id: 'PullRequest' });
        dataTable.addColumn({ type: 'date', id: 'Start' });
        dataTable.addColumn({ type: 'date', id: 'End' });
        dataTable.addRows([
        {% for pull in pr_list %}
          [ '{{pull.title}}', new Date({{ pull.created_at_js}}), new Date({{pull.closed_at_js}}) ] {% if not forloop.last %},{% endif %}
        {% endfor %}
          ]);

        chart.draw(dataTable);
      }
</script>
{% endblock %}