{% extends "base.html" %}
{% block content %}

<h1>{% block title %}Stats{% endblock %}</h1>

<b>Stats based on data from {{ pulls.count }} PR's</b>
<p>Used filter: {{ query_filter }}</p>

<table class="table">
    <thead>
    <tr>
        <th>Statistics</th>
        <th>Value</th>
        <th>PR</th>
    </tr>
    </thead>

    <tbody>
    <tr class="">
        <td>Fastest PR (shortest time opened)</td>
        <td>{{ fastest_pr.time_open }}</td>
        <td><a href="{% url 'pr_stats:detail' fastest_pr.number %}">{{ fastest_pr.title }}</a></td>
    </tr>
    <tr class="">
        <td>Slowest PR (longest time opened)</td>
        <td>{{ slowest_pr.time_open }}</td>
        <td><a href="{% url 'pr_stats:detail' slowest_pr.number %}">{{ slowest_pr.title }}</a></td>
    </tr>
    <tr class="">
        <td>Average time</td>
        <td>{{ average_time }}</td>
        <td>N/A</td>
    </tr>
    <tr class="">

        <td>Median time</td>
        <td>{{ median_time }}</td>
        <td>N/A</td>
    </tr>
    </tbody>
</table>

<p><a href="{% url 'pr_stats:statistics' previous.year previous.month previous.day %}">Previous week</a> |
<a href="{% url 'pr_stats:statistics' next.year next.month next.day %}">Next week</a></p>

<p><a href="{% url 'pr_stats:index' %}">&lt;&lt; Back</a></p>

{% if pulls %}
<table class="table" id="pr_table">
    <thead>
        <tr>
            <th>#</th>
            <th>Title</th>
            <th>User</th>
            <th>State</th>
            <th>Created</th>
            <th>Duration</th>
            <th>Links</th>
        </tr>
    </thead>

    <tbody>
        {% for pull in pulls %}
        <tr class="{{pull.alert}}">
            <td><a href="{% url 'pr_stats:detail' pull.number %}">{{ pull.number }}</a></td>
            <td><a href="{% url 'pr_stats:detail' pull.number %}">{{ pull.title }}</a></td>
            <td><img src="{{ pull.user.avatar_url }}" style="width:24px;height:24px;"></td>
            <td>{{ pull.state }}</td>
            <td>{{ pull.created_at }}</td>
            <td data-order="{{ pull.time_open_sec }}">{{ pull.time_open }}</td>
            <td><a href="{{pull.html_url}}" target="_blank">GitHub</a></td>
        </tr>
        {% endfor %}
    </tbody>
{% else %}
<p>No Pull Requests are available.</p>
{% endif %}

</table>

<script>
$(document).ready(function() {
    $('#pr_table').dataTable( {
        "pageLength": 50,
        "order": [[0, 'desc']]
    });
});
</script>

{% endblock %}